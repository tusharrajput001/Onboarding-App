define(["react","react-dom","big.js","mendix/filters/builders"],(function(e,t,l,a){"use strict";var r,n={exports:{}};
/*!
    Copyright (c) 2017 Jed Watson.
    Licensed under the MIT License (MIT), see
    http://jedwatson.github.io/classnames
  */r=n,function(){var e={}.hasOwnProperty;function t(){for(var l=[],a=0;a<arguments.length;a++){var r=arguments[a];if(r){var n=typeof r;if("string"===n||"number"===n)l.push(r);else if(Array.isArray(r)&&r.length){var u=t.apply(null,r);u&&l.push(u)}else if("object"===n)for(var i in r)e.call(r,i)&&r[i]&&l.push(i)}}return l.join(" ")}r.exports?(t.default=t,r.exports=t):window.classNames=t}();var u=n.exports;const i=({className:t,bootstrapStyle:l,children:a})=>e.Children.count(a)>0?e.createElement("div",{className:u("alert alert-".concat(l),t)},a):null;function o(t,l){const[a,r]=e.useState(),n=e.useCallback((()=>{const e=null==t?void 0:t.getBoundingClientRect();var l,n;n=a,(l=e)&&n&&l.height===n.height&&l.width===n.width&&l.bottom===n.bottom&&l.top===n.top&&l.left===n.left&&l.right===n.right||r(e)}),[a,t]);return function(t){const l=e.useRef(),a=e.useCallback((()=>{t(),l.current=window.requestAnimationFrame(a)}),[t]);e.useEffect((()=>{if(t)return l.current=window.requestAnimationFrame(a),()=>{window.cancelAnimationFrame(l.current)}}),[t,a])}(l?n:void 0),a}function s(l){const[a,r]=e.useState(l.defaultFilter),[n,i]=e.useState(!1),s=e.useRef(null),c=e.useRef(null);var d,v;d=[s,c],v=()=>i(!1),e.useEffect((()=>{const e=e=>{if(Array.isArray(d)){if(d.some((t=>!t.current||t.current.contains(e.target))))return}else if(!d.current||d.current.contains(e.target))return;v()};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[d,v]);const f=o(s.current,n),m=e.useCallback((e=>{r(e),l.onChange(e),i(!1)}),[l.onChange]);e.useEffect((()=>{r(l.defaultFilter),l.onChange(l.defaultFilter)}),[l.defaultFilter,l.onChange]);const b=t.createPortal(e.createElement("ul",{ref:c,id:"".concat(l.id,"-filter-selectors"),className:"filter-selectors",role:"menu","data-focusindex":0,style:{position:"fixed",top:null==f?void 0:f.bottom,left:null==f?void 0:f.left}},l.options.map(((t,r)=>e.createElement("li",{className:u({"filter-selected":a===t.value}),key:r,onClick:e=>{e.preventDefault(),e.stopPropagation(),m(t.value)},onKeyDown:e=>{var n,u;"Enter"===e.key||" "===e.key?(e.preventDefault(),e.stopPropagation(),m(t.value)):"Tab"===e.key&&r+1===l.options.length?(e.preventDefault(),m(a)):("Tab"===e.key&&e.shiftKey&&0===r||"Escape"===e.key)&&(e.preventDefault(),null===(u=null===(n=s.current)||void 0===n?void 0:n.querySelector("button"))||void 0===u||u.focus(),i(!1))},role:"menuitem",tabIndex:0},e.createElement("div",{className:u("filter-icon",t.value),"aria-hidden":!0}),e.createElement("div",{className:"filter-label"},t.label))))),document.body),p=e.useCallback((()=>{i((e=>!e)),setTimeout((()=>{var e,t;null===(t=null===(e=c.current)||void 0===e?void 0:e.querySelector("li.filter-selected"))||void 0===t||t.focus()}),10)}),[]);return e.createElement("div",{className:"filter-selector"},e.createElement("div",{className:"filter-selector-content",ref:s},e.createElement("button",{"aria-controls":"".concat(l.id,"-filter-selectors"),"aria-expanded":n,"aria-haspopup":!0,"aria-label":l.ariaLabel,className:u("btn btn-default filter-selector-button button-icon",a),onClick:p,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),p())}},"Â "),n&&b))}i.displayName="Alert";var c;function d(t){var a;const[r,n]=e.useState(t.defaultFilter),[i,o]=e.useState(void 0),[c,d]=e.useState(void 0),v=e.useRef(null);e.useEffect((()=>{t.value&&(d(t.value.toString()),o(t.value))}),[t.value]),e.useEffect((()=>{var e;null===(e=t.updateFilters)||void 0===e||e.call(t,i,r)}),[i,r]);const f=e.useCallback(((e,t)=>{let l=null;return(...a)=>{null!==l&&(clearTimeout(l),l=null),l=setTimeout((()=>e(...a)),t)}})((e=>o(e)),t.delay),[t.delay]),m=e.useCallback((()=>{v.current&&v.current.focus()}),[v]);return e.createElement("div",{className:u("filter-container",t.className),"data-focusindex":null!==(a=t.tabIndex)&&void 0!==a?a:0,style:t.styles},t.adjustable&&e.createElement(s,{ariaLabel:t.screenReaderButtonCaption,id:t.id,defaultFilter:t.defaultFilter,onChange:e.useCallback((e=>{n((t=>t===e?t:(m(),e)))}),[m]),options:[{value:"greater",label:"Greater than"},{value:"greaterEqual",label:"Greater than or equal"},{value:"equal",label:"Equal"},{value:"notEqual",label:"Not equal"},{value:"smaller",label:"Smaller than"},{value:"smallerEqual",label:"Smaller than or equal"}]}),e.createElement("input",{"aria-label":t.screenReaderInputCaption,className:u("form-control",{"filter-input":t.adjustable}),onChange:e=>{const t=e.target.value;t&&!isNaN(Number(t))?(d(t),f(new l.Big(Number(t)))):(d(t),f(void 0))},placeholder:t.placeholder,ref:v,type:"number",value:c}))}function v(e){if(e&&1===e.length){const[t]=e;let l="equal";switch(t.type){case">":l="greater";break;case">=":l="greaterEqual";break;case"=":l="equal";break;case"!=":l="notEqual";break;case"<":l="smaller";break;case"<=":l="smallerEqual"}return{type:l,value:t.value}}}function f(e){if(e)return Object.keys(e).map((t=>e[t])).filter((e=>e.type.match(/AutoNumber|Decimal|Integer|Long/)))}return function(e){e.Number="number",e.DateTime="datetime"}(c||(c={})),function(t){const l=e.useRef("NumberFilter".concat(function(){const e="com.mendix.widgets.web.UUID";return window[e]||(window[e]=1),window[e]++}())),r=window["com.mendix.widgets.web.filterable.filterContext"],n=e.createElement(i,{bootstrapStyle:"danger"},"The Number filter widget must be placed inside the header of the Data grid 2.0 or Gallery widget."),u=e.createElement(i,{bootstrapStyle:"danger"},'The Number filter widget can\'t be used with the filters options you have selected. It requires a "Autonumber, Decimal, Integer or Long" attribute to be selected.');return(null==r?void 0:r.Consumer)?e.createElement(r.Consumer,null,(r=>{var o,s,c,m,b,p,g;if(!r||!r.filterDispatcher||!r.singleAttribute&&!r.multipleAttributes)return n;const{filterDispatcher:h,singleAttribute:y,multipleAttributes:E,singleInitialFilter:w,multipleInitialFilters:C}=r,q=[...y?[y]:[],...E&&null!==(o=f(E))&&void 0!==o?o:[]];if(0===q.length)return E?u:n;const N=v(w||(null==C?void 0:C[q[0].id])),k=(A=q[0].type)&&!A.match(/AutoNumber|Decimal|Integer|Long/)?"The attribute type being used for Number filter is not 'Autonumber, Decimal, Integer or Long'":null;var A;return k?e.createElement(i,{bootstrapStyle:"danger"},k):e.createElement(d,{adjustable:t.adjustable,className:t.class,defaultFilter:null!==(s=null==N?void 0:N.type)&&void 0!==s?s:t.defaultFilter,delay:t.delay,id:l.current,placeholder:null===(c=t.placeholder)||void 0===c?void 0:c.value,screenReaderButtonCaption:null===(m=t.screenReaderButtonCaption)||void 0===m?void 0:m.value,screenReaderInputCaption:null===(b=t.screenReaderInputCaption)||void 0===b?void 0:b.value,styles:t.style,tabIndex:t.tabIndex,updateFilters:(e,l)=>{var r,n,u,i,o;(e&&!(null===(n=null===(r=t.valueAttribute)||void 0===r?void 0:r.value)||void 0===n?void 0:n.eq(e))||e!==(null===(u=t.valueAttribute)||void 0===u?void 0:u.value))&&(null===(i=t.valueAttribute)||void 0===i||i.setValue(e),null===(o=t.onChange)||void 0===o||o.execute());const s=null==q?void 0:q.map((t=>function(e,t,l){if(!e||!e.filterable||!t)return;return{greater:a.greaterThan,greaterEqual:a.greaterThanOrEqual,equal:a.equals,notEqual:a.notEqual,smaller:a.lessThan,smallerEqual:a.lessThanOrEqual}[l](a.attribute(e.id),a.literal(t))}(t,e,l))).filter((e=>void 0!==e));h({getFilterCondition:()=>s&&s.length>1?a.or(...s):null==s?void 0:s[0],filterType:"number"})},value:null!==(p=null==N?void 0:N.value)&&void 0!==p?p:null===(g=t.defaultValue)||void 0===g?void 0:g.value})})):n}}));
